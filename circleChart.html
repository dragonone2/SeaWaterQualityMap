<!DOCTYPE html>
<meta charset="utf-8">

<style>
    .arc text {
        font: 10px sans-serif;
        text-anchor: middle;
    }

    .arc path {
        stroke: #fff;
    }
</style>

<script src="https://d3js.org/d3.v6.min.js"></script>

<body>
    <script>
        var width = 960;
        var height = 450;
        var margin = 40;

        d3.csv("Ocean_Quailty3.csv").then(function(data) {
            var targetRow = data.find(function(d) {
                return d["연안구분명(1)"] === "속초연안";
            });

            var values = Object.values(targetRow).slice(3).map(parseFloat);
            var keys = Object.keys(targetRow).slice(3);

            var filteredValues = values.filter(function(value) {
                return !isNaN(value);
            });

            var filteredKeys = keys.slice(0, filteredValues.length);

            var radius = Math.min(width, height) / 2 - margin;

            var svg = d3.select("body")
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

            var arcGenerator = d3.arc()
                .innerRadius(0)
                .outerRadius(radius);

            var pie = d3.pie().value(function(d) { return d; });
            var data_ready = pie(filteredValues);

            var arcs = svg.selectAll('path')
                .data(data_ready)
                .enter()
                .append('path')
                .attr('d', arcGenerator)
                .attr('fill', function(d, i) { return d3.schemeCategory10[i]; })
                .attr("stroke", "white")
                .style("stroke-width", "2px")
                .style("opacity", 0.7);

            var legend = svg.selectAll(".legend")
                .data(filteredKeys)
                .enter()
                .append("text")
                .attr("transform", function(d, i) { return "translate(" + (width / 2 - 200) + "," + ((i * 20) - height / 2 + 20) + ")"; })
                .attr("x", 100)
                .attr("y", 9)
                .attr("dy", ".35em")
                .text(function(d, i) { return d + ": " + filteredValues[i]; });
        });
    </script>
</body>
