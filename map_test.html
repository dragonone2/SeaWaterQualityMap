<!DOCTYPE html>
<html lang="ko">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<!-- OpenLayers CDN -->
<script src="https://openlayers.org/en/v4.6.5/build/ol.js"></script> 
<link rel="stylesheet" href="https://openlayers.org/en/v4.6.5/css/ol.css" type="text/css"> 
<script src="https://code.jquery.com/jquery-2.2.3.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script type="text/javascript">    
 
    function selectBaseMap() {
      var opt = document.getElementById("selectBaseMap");
      var optVal = opt.options[opt.selectedIndex].value;
 
      var layer = layers[optVal];
      
      if (layer) {
            //layer.setOpacity(1);        //불투명도
            updateRenderEdgesOnLayer(layer);
            map.getLayers().setAt(0, layer);
        }    
      
    }
    //배경지도 변경
    var updateRenderEdgesOnLayer = function(layer) {
        if (layer instanceof ol.layer.Tile) {
            var source = layer.getSource();
        }
    };
    
    //해구도 그리드 선택(OPEN-API)
    function selectWms_change() {
 
        var opt = document.getElementById("select_wms");
        var optVal = opt.options[opt.selectedIndex].value;
        
        if(baseMapLayerMap != null){
            map.removeLayer(baseMapLayerMap.get("selectBox"));
        }
        var API_KEY = $('#API_KEY').val();
        var API_DOMAIN = $('#API_DOMAIN').val();
        if(API_KEY == null || API_KEY ==""){
            alert("API_KEY를 입력해주세요");
            return;
        }
        if(API_DOMAIN == null || API_KEY ==""){
            alert("API_DOMAIN을 입력해주세요");
            return;
        }
            
        
        var this_val = optVal;
        var this_title = "test";
        
        
          map.getLayers().forEach(function(layer){
              if(layer.get("name")=="wms_theme"){
                     map.removeLayer(layer);//기존결과 삭제        
             } 
            
         }) 
        var wms_tile = new ol.layer.Tile({
            title: this_title,
            name : "wms_theme",
            id: this_val,
            source : new ol.source.TileWMS({
                url : "http://192.168.0.18/kodispub/openApi/wms.do?",
                params : {
                    LAYERS : this_val.toLowerCase(),    //해구도레이어명(소문자)
                    STYLES : this_val.toLowerCase(),    //해구도레이어스타일(소문자)
                    CRS : "EPSG:3857",                    //좌표
                    apikey : API_KEY ,                     //사용자 API-KEY 정보
                    domain : API_DOMAIN ,                //사용자 도메인정보
                    bbox : "13803616.8583659,3697855.3303377,14471533.8031256,4579425.8128701",
                    title : this_title,                    //타이틀
                    FORMAT : "image/png",
                    VERSION : "1.1.0"
                    
                }
            })
        });
 
        map.addLayer(wms_tile);            //해구도레이어 표출
        
        
    }
    
    
    
</script>
 
</head>
<body>
    <!-- 배경지도 생성 위치 -->
    <div id="map" tabindex="0" style="position: relative; width: 100%; height: 760px; left: 0px; top: 0px;" oncontextmenu="return false"></div>
    <div class="apiPreview">
        <table>
            <caption>OPEN-API WMS 미리보기</caption>
            <colgroup>
                <col class="w100">
                <col class="w220">
                <col class="w90">
                <col class="w170">
                <col class="w100">
                <col class="ato">
            </colgroup>
            <tbody>
            <tr>
                <th scope="row">API_KEY</th>
                <td><input  type="text" name="API_KEY" id="API_KEY" title="API_KEY" ></td>
                <th scope="row">도메인</th>
                <td colspan="3"><input type="text" name="API_DOMAIN" id="API_DOMAIN" title="API_DOMAIN"></td>
            </tr>
            <tr>
                <th scope="row">배경지도선택</th>
                <td>
                    <select id="selectBaseMap" onchange="selectBaseMap()">
                        <option>선택</option>
                        <option value='osm'>OSM(오픈스트리트맵)</option>
                        <option value='vworld'>브이월드지도</option>
                        <option value='satellite'>브이월드위성지도</option>
                    </select>
                </td>
                <th scope="row">해구도 선택</th>
                <td>
                    <select id="select_wms" onchange="selectWms_change()">
                        <option>선택</option>
                        <option value='lage_trench_sarea_m'>대해구도</option>
                        <option value='mwg_trench_sarea_m'>소해구도</option>
                        <option value='mwg_msp_grid_v2_m'>MSP</option>
                    </select>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</body>
 
<script type="text/javascript">    
    /*
     * OpenLayers4를 이용해 설정된 지도의 기본 기능
     */
 
    // 기본 지도에 사용되는 레이어 관리 
    var baseMapLayerMap = null;
    
    <!-- 레이어 선언 -->
    var layers = {};
 
    //vworld 배경지도
    layers['vworld'] = new ol.layer.Tile({
 
        title : 'VWorld Gray Map',
 
        visible : true,
 
        type : 'base',
 
        source : new ol.source.XYZ({
 
            url : 'http://xdworld.vworld.kr:8080/2d/Base/201612/{z}/{x}/{y}.png'
 
        })
 
    });
    
    // OSM 배경지도
    layers['osm'] = new ol.layer.Tile({
 
        title : 'VWorld Gray Map',
 
        visible : true,
 
        type : 'base',
 
        source: new ol.source.OSM()
 
    });
    
    // 브이월드 위성배경지도
     layers['satellite'] = new ol.layer.Tile({
 
        title : 'VWorld Gray Map',
 
        visible : true,
 
        type : 'base',
 
        source : new ol.source.XYZ({
 
            url : 'http://xdworld.vworld.kr:8080/2d/Satellite/201612/{z}/{x}/{y}.jpeg'
 
        })
 
    });
    
    // vectorSource 선언
 
    var vectorSource = new ol.source.Vector({
 
        projection: 'EPSG:4326'
 
    });
    
      // vectorLayer 선언
 
    var vectorLayer = new ol.layer.Vector({
 
        source: vectorSource
    });
    
    // target에 배경지도 기본맵 선언
    var map = new ol.Map({
       target: 'map',
       layers : [ layers['vworld'], vectorLayer ],        //기본맵 세팅(브이월드)
       view: new ol.View({
       center:ol.proj.transform([127, 36], 'EPSG:4326', 'EPSG:3857'),
        zoom: 7,
        minZoom: 5,
        maxZoom: 15
        // Projection 어떤 좌표체계로 투영할것인지 설정해주는 부분입니다.
        // Default는 EPSG:3857 입니다.
    })
 
    });
    
</script>
</html>
